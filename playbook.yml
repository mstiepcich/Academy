---
- hosts: staging 
  tasks:

    - name: agregar host local
      command: cp /vagrant/inventory /etc/ansible/hosts

    - name: copio ansible.cfg
      command: cp /vagrant/ansible.cfg /etc/ansible/

    - name: copiar ppk
      command: cp /vagrant/id_rsa /home/vagrant/.ssh/
    
    - name: cambio permisos de key
      command: chmod 700 /home/vagrant/.ssh/id_rsa

    - name: modificar ssh_config
      command: cp /vagrant/ssh_config /etc/ssh/

    - name: cambiar permisos key
      command: chown vagrant:vagrant /home/vagrant/.ssh/id_rsa

    - name: mover index
      command: cp -r /vagrant/htdocs /home/vagrant/

    - name: permisos htdocs
      command: chown -R vagrant:vagrant /home/vagrant/htdocs

    - name: modificar index
      command: sed -i "s/replaceHostname/Staging/g" /home/vagrant/htdocs/index.html 

    - name: ejecutar otro playbook.
      command: ansible-playbook -i /etc/ansible/hosts /vagrant/production.yml
      become_user: vagrant
